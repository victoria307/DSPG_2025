---
title: "Return to Education in U.S. 1940-2005: Data Cleaning Process"
author: "Henderson, Polachek, and Wang"
date: "2009-05-21"
date-modified: "2024-09-24"
format: 
  html:
    toc: true
    toc-depth: 3
    code-fold: false
    theme: cosmo
  pdf:
    toc: true
    number-sections: true
execute:
  warning: false
  message: false
  cache: true
---

## Project Overview

**Update Notes:**\
*09/24/2024: add school_sp as instrument*

This document outlines the data cleaning process for analyzing returns to education in the United States from 1940 to 2005, using IPUMS data.

## Setup

```{r setup}
#| label: setup
#| include: true

# Load required libraries
library(dplyr)
library(readr)
library(haven)      # for reading Stata files
library(tidyr)
library(ggplot2)
library(knitr)
library(here)
library(quarto)    # for running the quanto 


# Set working directory
setwd("/Users/zhaoxiaoxiao/Desktop/2000 Educ_Return_R")

# Set global options
options(scipen = 999)  # Avoid scientific notation
```

## Part I: Data Cleaning Process

### Step 1: Data Import and Renaming {#sec-step1}

Download data from IPUMS in Stata format and rename by year.

```{r step1}
#| label: data-import
#| eval: false

# Execute data import and renaming script
quarto_render("program/cl_00.qmd")
```

**Purpose:** Import raw IPUMS data files and establish consistent naming conventions by survey year.

### Step 2: Clean Allocated Values {#sec-step2}

Remove or flag all allocated values in the dataset.

```{r step2}
#| label: clean-allocated
#| eval: false

# Clean up all allocated values
quarto_render("program/cl_01.qmd")
```

**Purpose:** Ensure data quality by handling allocated/imputed values that may introduce bias in our analysis.

### Step 3: Variable Generation and Transformation {#sec-step3}

This step involves multiple sub-processes to create analysis-ready variables:

```{r step3}
#| label: variable-generation
#| eval: false

# Generate and keep relevant variables
quarto_render("program/cl_02.qmd")
```

**Key transformations include:**

a.  **Missing Value Treatment**: Replace N/A values with proper missing value codes
b.  **Top-coding Indicator**: Generate variable indicating whether individual's wage is top-coded
c.  **Inflation Adjustment**: Adjust wages for inflation using appropriate price indices
d.  **Education Variables**:
    -   Recode education variable
    -   Generate potential experience
    -   Generate education variable for spouse
e.  **Earnings Variables**: Create standardized earnings measures
f.  **Covariates**: Generate and retain other relevant control variables

### Step 4: Sample Restrictions {#sec-step4}

Apply sample restrictions to create the final analytical dataset.

```{r step4}
#| label: sample-restrictions
#| eval: false

# Apply sample restrictions
quarto_render("program/cl_03.qmd")
```

**Purpose:** Implement inclusion/exclusion criteria to define the population of interest for the returns to education analysis.

## Data Processing Summary

The data cleaning process follows a systematic approach:

1.  **Raw Data Import** → Standardized file structure
2.  **Quality Control** → Remove problematic allocated values\
3.  **Feature Engineering** → Create analysis variables
4.  **Sample Definition** → Apply research-specific restrictions

## Next Steps

After completing the data cleaning process, the dataset will be ready for:

-   Descriptive analysis
-   Returns to education estimation
-   Instrumental variable analysis (using school_sp as instrument)
-   Robustness checks

## File Structure

```         
project/
├── program/
│   ├── cl_00.R    # Data import and renaming
│   ├── cl_01.R    # Clean allocated values
│   ├── cl_02.R    # Variable generation
│   └── cl_03.R    # Sample restrictions
└── data/
    └── [IPUMS data files]
```

------------------------------------------------------------------------

*This document was converted from the original Stata workflow to ensure reproducibility and transparency in the data cleaning process.*
